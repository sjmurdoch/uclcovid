<html>
<head>
	<title>Daily reported cases for UCL staff and students</title>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.js"></script>
  <style>
		canvas {
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
		}
	</style>
</head>

<body>
	<div style="width:75%;">
		<canvas id="canvas"></canvas>
	</div>
  <div>


	<script>
    //var dataURL = 'http://localhost:9123/data/covid.json';
		var dataURL = 'data/covid.json';

    var chartColors = {
       // From https://personal.sron.nl/~pault/#sec:qualitative
	     rose: '#CC6677',
       indigo: '#332288',
       sand: '#DDCC77',
       green: '#117733',
       cyan: '#88CCEE',
       wine: '#882255',
       teal: '#44AA99',
       olive: '#999933',
       purple: '#AA4499',
       grey: '#DDDDDD'
    };

		var color = Chart.helpers.color;
		var config = {
			type: 'line',
			data: {
				datasets: [{
					label: 'Staff (on campus)',
					backgroundColor: color(chartColors.cyan).alpha(0.5).rgbString(),
					borderColor: chartColors.cyan,
					fill: false,
					data: [],
				},
        {
          label: 'Staff (off campus)',
          backgroundColor: color(chartColors.green).alpha(0.5).rgbString(),
          borderColor: chartColors.green,
          fill: false,
          data: [],
        },{
          label: 'Students (on campus)',
          backgroundColor: color(chartColors.rose).alpha(0.5).rgbString(),
          borderColor: chartColors.rose,
          fill: false,
          data: [],
        },{
          label: 'Students (off campus)',
          backgroundColor: color(chartColors.sand).alpha(0.5).rgbString(),
          borderColor: chartColors.sand,
          fill: false,
          data: [],
        }]
			},
			options: {
				title: {
					text: 'Daily reported cases for UCL staff and students',
          display: true
				},
        legend: {
          position: 'bottom'
        },
				scales: {
					xAxes: [{
						type: 'time',
						time: {
							parser: 'YYYY-MM-DD',
							round: 'day',
							tooltipFormat: 'YYYY-MM-DD',
              unit: 'day',
              displayFormats: {
                day: 'DD MMM'
              }
						},
						scaleLabel: {
							display: true,
							labelString: 'Date'
						}
					}],
					yAxes: [{
						scaleLabel: {
							display: true,
							labelString: 'New cases (last 24 hours)'
						}
					}]
				},
			}
		};

    function parseData(dataSets, dataSetName) {
      data = []
      for (let [d, c] of dataSets[dataSetName]) {
        data.push({x: d, y: c});
      }
      return data
    }

    let request = new XMLHttpRequest();
    request.open('GET', dataURL);
    request.responseType = 'json';
    request.send();
    request.onload = function() {
      dataSets = request.response
      config.data.datasets[0].data = parseData(window.dataSets, "staff.on")
      config.data.datasets[1].data = parseData(window.dataSets, "staff.off")
      config.data.datasets[2].data = parseData(window.dataSets, "student.on")
      config.data.datasets[3].data = parseData(window.dataSets, "student.off")
      var ctx = document.getElementById('canvas').getContext('2d');
      window.covid = new Chart(ctx, config);
    };

	</script>
</body>

</html>
